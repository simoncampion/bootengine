#!/bin/bash

set -e

UNIT_DIR="$1"

if cat /proc/cmdline | grep -qw "rd.networkd=1"; then
    mkdir -p "${UNIT_DIR}/dracut-initqueue.service.d"

    cat >${UNIT_DIR}/dracut-initqueue.service.d/networkd_dependency.conf <<EOF
    # Automatically generated by networkd-dependency-generator

    [Unit]
    Wants=systemd-networkd.service systemd-resolved.service network-online.target
    After=systemd-networkd.service systemd-resolved.service network-online.target
EOF
fi